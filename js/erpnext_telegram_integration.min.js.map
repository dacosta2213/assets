{"version":3,"file":"erpnext_telegram_integration.min.js","sources":["../../../apps/erpnext_telegram_integration/erpnext_telegram_integration/public/js/erpnext_telegram_integration.js"],"sourcesContent":["$(document).on('app_ready', function() {\n    // waiting for page to load completely\n   \n        var route = frappe.get_route();\n\n        if (route[0] == \"Form\") {\n            frappe.ui.form.on(route[1], {\n                refresh: function (frm) {\n                    cur_frm.page.add_menu_item(__(\"Send To Telegram\"), function() {\n                        var user_name = frappe.user.name;\n                        var user_full_name = frappe.session.user_fullname;\n                        var reference_doctype = cur_frm.doctype;\n                        var reference_name = cur_frm.docname;\n                        var dialog = new frappe.ui.Dialog({\n                            'fields': [\n                                {'fieldname': 'ht', 'fieldtype': 'HTML'},\n                                {'label':'Send To','fieldname': 'telegram_user', 'reqd': 1, 'fieldtype': 'Link','options': 'Telegram User Settings'},\n                                {'label':'Subject','fieldname': 'subject', 'reqd': 1, 'fieldtype': 'Data','default': cur_frm.doc.name},\n                                {'label':'Message','fieldname': 'message', 'reqd': 1, 'fieldtype': 'SmallText'},\n                                {'label':'Attach Document Print','fieldname': 'attach_document_print', 'fieldtype': 'Check'},\n                               \n                            ],\n                            'primary_action_label': 'Send',\n                            'title':'Send a Telegram Message',\n\n                            primary_action: function(){\n                                var values = dialog.get_values();\n                                if(values) {\n                                    var space = \"\\n\"+\"\\n\";\n                                    var the_message = \"From : \" + user_full_name + space + values.subject + space + values.message;\n\n                                    // send telegram msg\n                                    frappe.call({\n                                        method: \"erpnext_telegram_integration.erpnext_telegram_integration.doctype.telegram_settings.telegram_settings.send_to_telegram\",\n                                        args: {\n                                            telegram_user: values.telegram_user,\n                                            message: the_message,\n                                            reference_doctype: reference_doctype,\n                                            reference_name: reference_name,\n                                            attachment: values.attach_document_print,\n                                        },\n                                        freeze: true,\n                                        callback: (r) => {\n                                            frappe.msgprint(__(\"Successfully Sent to: \" + values.telegram_user));\n                                            dialog.hide();\n                                        }\n                                    });\n\n                                    // add comment\n                                    var comment_message = 'To : ' + values.telegram_user + space + values.message;\n                                    frappe.call({\n                                        method: \"frappe.desk.form.utils.add_comment\",\n                                        args: {\n                                            reference_doctype: reference_doctype,\n                                            reference_name: reference_name,\n                                            content: comment_message,\n                                            comment_email: frappe.session.user\n                                        },\n                                    });\n                                }\n                               \n                            },\n                            no_submit_on_enter: true,\n                        });\n                        dialog.fields_dict.ht.$wrapper.html(reference_name);\n                        dialog.show();\n                    });\n                }\n            })\n \n\n        }\n    \n});"],"names":["$","document","on","route","frappe","get_route","ui","form","refresh","frm","cur_frm","page","add_menu_item","__","user","name","user_full_name","session","user_fullname","reference_doctype","doctype","reference_name","docname","dialog","Dialog","fields","fieldname","fieldtype","label","reqd","options","default","doc","primary_action_label","title","primary_action","values","get_values","the_message","subject","message","call","method","args","telegram_user","attachment","attach_document_print","freeze","callback","r","msgprint","hide","comment_message","content","comment_email","no_submit_on_enter","fields_dict","ht","$wrapper","html","show"],"mappings":"yBAAAA,EAAEC,UAAUC,GAAG,YAAa,WAGpB,IAAIC,EAAQC,OAAOC,YAEH,QAAZF,EAAM,IACNC,OAAOE,GAAGC,KAAKL,GAAGC,EAAM,GAAI,CACxBK,QAAS,SAAUC,GACfC,QAAQC,KAAKC,cAAcC,GAAG,oBAAqB,WAC/BT,OAAOU,KAAKC,KAA5B,IACIC,EAAiBZ,OAAOa,QAAQC,cAChCC,EAAoBT,QAAQU,QAC5BC,EAAiBX,QAAQY,QACzBC,EAAS,IAAInB,OAAOE,GAAGkB,OAAO,CAC9BC,OAAU,CACN,CAACC,UAAa,KAAMC,UAAa,QACjC,CAACC,MAAQ,UAAUF,UAAa,gBAAiBG,KAAQ,EAAGF,UAAa,OAAOG,QAAW,0BAC3F,CAACF,MAAQ,UAAUF,UAAa,UAAWG,KAAQ,EAAGF,UAAa,OAAOI,QAAWrB,QAAQsB,IAAIjB,MACjG,CAACa,MAAQ,UAAUF,UAAa,UAAWG,KAAQ,EAAGF,UAAa,aACnE,CAACC,MAAQ,wBAAwBF,UAAa,wBAAyBC,UAAa,UAGxFM,qBAAwB,OACxBC,MAAQ,0BAERC,eAAgB,WACZ,IAAIC,EAASb,EAAOc,aACpB,GAAGD,EAAQ,CACP,IACIE,EAAc,UAAYtB,EADlB,OAC2CoB,EAAOG,QADlD,OACoEH,EAAOI,QAGvFpC,OAAOqC,KAAK,CACRC,OAAQ,yHACRC,KAAM,CACFC,cAAeR,EAAOQ,cACtBJ,QAASF,EACTnB,kBAAmBA,EACnBE,eAAgBA,EAChBwB,WAAYT,EAAOU,uBAEvBC,QAAQ,EACRC,kBAAWC,GACP7C,OAAO8C,SAASrC,GAAG,yBAA2BuB,EAAOQ,gBACrDrB,EAAO4B,UAKf,IAAIC,EAAkB,QAAUhB,EAAOQ,cArB3B,OAqBmDR,EAAOI,QACtEpC,OAAOqC,KAAK,CACRC,OAAQ,qCACRC,KAAM,CACFxB,kBAAmBA,EACnBE,eAAgBA,EAChBgC,QAASD,EACTE,cAAelD,OAAOa,QAAQH,UAM9CyC,oBAAoB,IAExBhC,EAAOiC,YAAYC,GAAGC,SAASC,KAAKtC,GACpCE,EAAOqC"}